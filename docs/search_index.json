[["2-control.html", "2 Control 2.1 Area foliar 2.2 Enfermedades 2.3 ABC de las métricas evaluadas", " 2 Control pacman::p_load(tidyverse) load(&quot;data/nova_trigo.Rdata&quot;) source(here::here(&#39;theme_juan.R&#39;)) # assum_lm &lt;- &quot;https://github.com/juanchiem/R-sources-Juan/blob/master/lm_assumptions.R?raw=TRUE&quot; # devtools::source_url(assum_lm) 2.1 Area foliar glimpse(dat) ## Rows: 240 ## Columns: 23 ## $ id &lt;chr&gt; &quot;1.1&quot;, &quot;1.1&quot;, &quot;1.1&quot;, &quot;1.1&quot;, &quot;1.2&quot;, &quot;1.2&quot;, &quot;1.2&quot;, &quot;1.2&quot;, &quot;1.3&quot;… ## $ trt &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2… ## $ rep &lt;dbl&gt; 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 1, 1, 1, 1, 2… ## $ eval &lt;dbl&gt; 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0… ## $ fecha &lt;date&gt; 2020-10-31, 2020-11-10, 2020-11-19, 2020-12-01, 2020-10-31, … ## $ dias &lt;dbl&gt; 0, 10, 19, 31, 0, 10, 19, 31, 0, 10, 19, 31, 0, 10, 19, 31, 0… ## $ verdor &lt;dbl&gt; 100.00000, 100.00000, 80.00000, 43.47826, 100.00000, 100.0000… ## $ inc_e1 &lt;dbl&gt; 4.444444, 3.333333, 5.000000, 10.000000, 4.444444, 3.448276, … ## $ inc_e2 &lt;dbl&gt; 62.222222, 76.666667, 86.750000, 70.000000, 62.222222, 79.310… ## $ inc_e3 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0… ## $ inc_e4 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0… ## $ inc_e5 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0… ## $ int_e1 &lt;dbl&gt; 0.44444444, 0.33333333, 0.15000000, 0.10000000, 0.44444444, 0… ## $ int_e2 &lt;dbl&gt; 5.5760684, 6.7977778, 13.4623148, 6.2000000, 5.5760684, 8.426… ## $ int_e3 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0… ## $ int_e4 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0… ## $ int_e5 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0… ## $ ABC_verd &lt;dbl&gt; 0.0000, 1000.0000, 810.0000, 740.8696, 0.0000, 1000.0000, 761… ## $ ABC_e1 &lt;dbl&gt; 0.0000000, 3.8888889, 2.1750000, 1.5000000, 0.0000000, 2.3946… ## $ ABC_e2 &lt;dbl&gt; 0.000000, 61.869231, 91.170417, 117.973889, 0.000000, 70.0139… ## $ ABC_e3 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0… ## $ ABC_e4 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0… ## $ af_sana &lt;dbl&gt; 94.42393, 93.20222, 66.53769, 37.27826, 94.42393, 91.57328, 5… \\(Verdor - severidad~media~enf_{(i)}\\) Area foliar activa y severidad dat %&gt;% dplyr::select(-matches(&quot;e1&quot;)) %&gt;% pivot_longer( cols = c(&quot;verdor&quot;, &quot;int_e2&quot;), names_to = &quot;var&quot;, values_to = &quot;val&quot;) %&gt;% mutate(var = factor(var), var = fct_relevel(var, &quot;verdor&quot;)) %&gt;% ggplot()+ aes(x=dias, y=val, col = var)+ facet_wrap(&quot;trt&quot;)+ stat_summary(fun = &quot;mean&quot;, geom=&quot;crossbar&quot;, size = 0.1, width = 0.5)+ geom_point(alpha=0.3) + stat_summary(fun=mean, geom=&quot;line&quot;, size=0.7, aes(col=var, group=var)) + scale_color_manual(labels = c( &quot;AF activa&quot;, &quot;Sev media RE(%)&quot;), values = c(&quot;green3&quot;, &quot;red3&quot;)) + theme_juan(12, &quot;top&quot;)+ labs(title = &quot;Evolución área foliar&quot;, y = &quot;%&quot;, x = &quot;Días desde aplicado&quot;, col = &quot;&quot;, caption = &quot;AF activa = Proporción de hojas con &gt;50% de verdor\\nSeveridad media (considera los 0%)&quot;) # ggsave(last_plot(), file = &quot;plots/evol_AF.png&quot;, w=6.5, h=7) # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;nova/nova_trigo/evol_AF_tr.png&quot;, overwrite = TRUE) Area foliar Sana \\(Area foliar activa - severidad media de las enfermedades presentes\\) Es una represntación indirecta del área fotisintéticamente activa dat %&gt;% ggplot()+ aes(x=dias, y=af_sana)+ geom_point()+ stat_summary(fun =&quot;mean&quot;, geom=&quot;line&quot;)+ stat_summary(fun = &quot;mean&quot;, geom = &quot;area&quot;, fill = &quot;green&quot;, alpha = .3) + facet_wrap(&quot;trt&quot;)+ labs(title = &quot;Área foliar sana&quot;, col = &quot;Bloque&quot;, y = &quot;%&quot;, x = &quot;Días desde aplicado&quot;, caption = &quot;AF_sana = AF_activa - Severidad media roya estriada)&quot;)+ theme_juan(12, &quot;top&quot;) # ggsave(last_plot(), file = &quot;plots/AF_sana.png&quot;, w=7, h=6) # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;nova/nova_trigo/AF.png&quot;, overwrite = TRUE) # Cuando hubiera mas de una enfermedad, probablemente esto ayudaria # dat_long &lt;- dat %&gt;% # select(trt, rep, dias, matches(&quot;e2&quot;), -contains(&quot;ABC&quot;))%&gt;% # pivot_longer( # cols = matches(&quot;e2&quot;), # names_to = &quot;var&quot;, # values_to = &quot;val&quot;) %&gt;% # separate(var, c(&#39;metric&#39;, &#39;enf&#39;), sep = &#39;_&#39;, convert = TRUE) %&gt;% # mutate(enf_lab = factor(case_when( # enf == &quot;e1&quot;~ &quot;Mancha amarilla&quot;, # enf == &quot;e2&quot;~ &quot;Roya estriada&quot;))) 2.2 Enfermedades 2.2.1 E2 Incidencia e2 dat %&gt;% ggplot()+ aes(x=dias, y=inc_e2)+ geom_point()+ stat_summary(fun =&quot;mean&quot;, geom=&quot;line&quot;)+ stat_summary(fun = &quot;mean&quot;, geom = &quot;area&quot;, fill = &quot;#EB5286&quot;, alpha = .5) + facet_wrap(&quot;trt&quot;)+ labs(title = &quot;Incidencia roya estriada&quot;, # col = &quot;&quot;, y = &quot;%&quot;, x = &quot;Días desde aplicado&quot;)+ theme_juan(12, &quot;top&quot;) # ggsave(last_plot(), file = &quot;plots/incidencia_RE.png&quot;, w=7, h=6) # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;nova/nova_trigo/incidencia_RE.png&quot;, overwrite = TRUE) Severidad media e2 dat %&gt;% ggplot()+ aes(x=dias, y=int_e2 # col=enf_lab )+ geom_point()+ stat_summary(fun =&quot;mean&quot;, geom= &quot;line&quot;)+ stat_summary(fun = &quot;mean&quot;, geom = &quot;area&quot;, fill = &quot;#EB5286&quot;, alpha = .5) + facet_wrap(&quot;trt&quot;)+ labs(title = &quot;Severidad media roya estriada&quot;, y = &quot;%&quot;, x = &quot;Días desde aplicado&quot;)+ theme_juan(12, &quot;top&quot;) # ggsave(last_plot(), file = &quot;plots/severidad_RE.png&quot;, w=7, h=6) # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;nova/nova_trigo/severidad_RE.png&quot;, overwrite = TRUE) 2.3 ABC de las métricas evaluadas abc_dat &lt;- dat %&gt;% group_by(trt, rep, .drop=FALSE) %&gt;% summarise(across(c(&quot;verdor&quot;, &quot;int_e2&quot;, &quot;af_sana&quot;), ~MESS::auc(dias,.x, type = &quot;linear&quot;))) %&gt;% mutate_at(vars(trt, rep), as.factor) ## `summarise()` has grouped output by &#39;trt&#39;. You can override using the `.groups` argument. # abc_dat %&gt;% # purrr::modify_if(., ~is.numeric(.), ~round(., 1)) %&gt;% # write_sheet(ss=nova_tr, sheet = &quot;ABC&quot;) pacman::p_load(lme4, emmeans, multcomp) ABC de AF sana - modelo m0 = lmer(af_sana ~ trt + (1|rep), data = abc_dat) plot(m0) car::Anova(m0) ## Registered S3 methods overwritten by &#39;car&#39;: ## method from ## influence.merMod lme4 ## cooks.distance.influence.merMod lme4 ## dfbeta.influence.merMod lme4 ## dfbetas.influence.merMod lme4 ## Analysis of Deviance Table (Type II Wald chisquare tests) ## ## Response: af_sana ## Chisq Df Pr(&gt;Chisq) ## trt 137.97 14 &lt; 2.2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 summary(m0) ## Linear mixed model fit by REML [&#39;lmerMod&#39;] ## Formula: af_sana ~ trt + (1 | rep) ## Data: abc_dat ## ## REML criterion at convergence: 555.4 ## ## Scaled residuals: ## Min 1Q Median 3Q Max ## -2.76983 -0.53442 0.09575 0.49062 2.28207 ## ## Random effects: ## Groups Name Variance Std.Dev. ## rep (Intercept) 239.1 15.46 ## Residual 8244.9 90.80 ## Number of obs: 60, groups: rep, 4 ## ## Fixed effects: ## Estimate Std. Error t value ## (Intercept) 2339.83 46.05 50.806 ## trt2 514.80 64.21 8.018 ## trt3 563.46 64.21 8.776 ## trt4 436.87 64.21 6.804 ## trt5 527.08 64.21 8.209 ## trt6 554.94 64.21 8.643 ## trt7 534.11 64.21 8.319 ## trt8 581.72 64.21 9.060 ## trt9 544.44 64.21 8.480 ## trt10 492.81 64.21 7.675 ## trt11 560.32 64.21 8.727 ## trt12 492.78 64.21 7.675 ## trt13 475.49 64.21 7.406 ## trt14 568.48 64.21 8.854 ## trt15 563.83 64.21 8.782 ## ## Correlation matrix not shown by default, as p = 15 &gt; 12. ## Use print(x, correlation=TRUE) or ## vcov(x) if you need it pred_e0 = emmeans(m0, ~ trt, type = &quot;response&quot;) res_e0 &lt;- cld(pred_e0, Letters = letters, alpha = .05, type = &quot;response&quot;, reversed = T) plot(res_e0, alpha =0.5) + geom_vline(xintercept = res_e0 %&gt;% filter(trt==1) %&gt;% pull(emmean), linetype = 2, col =&quot;gray50&quot;)+ coord_flip()+ geom_point(data = abc_dat, aes(x = af_sana, y = trt), pch=21, position=position_dodge(width=1), size = 2) + geom_text(data = res_e0, angle=90, vjust=-0.7, aes(x = emmean, y = trt, label = .group), size = 4)+ labs(x=&quot;ABC AF sana&quot;, y = &quot;Tratamiento&quot;)+ theme_juan(9, &quot;bottom&quot;)+ scale_x_continuous(breaks=scales::pretty_breaks()) # ggsave(&quot;plots/abc_AFsana_model.jpg&quot;, width = 15, height = 10, units = &quot;cm&quot;, last_plot(), dpi = 600) # # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;nova_trigo/abc_AFsana_model.jpg&quot;, overwrite = TRUE) res_e0 %&gt;% mutate( &#39;IC_95%&#39;=paste0(round(lower.CL,0),&quot;;&quot;, round(upper.CL,0)), dif=(emmean-filter(res_e0,trt==1)%&gt;%pull(emmean)), `dif_%`=(emmean/filter(res_e0,trt==1)%&gt;%pull(emmean)-1)*100) %&gt;% dplyr::select(Trat=trt, AF_sana= emmean, `Tukey_5%` = .group, dif,`dif_%`, &#39;IC_95%&#39;) %&gt;% purrr::modify_if(., ~is.numeric(.), ~round(., 1)) %&gt;% arrange(Trat) #%&gt;% ## Trat AF_sana Tukey_5% dif dif_% IC_95% ## 1 1 2339.8 b 0.0 0.0 2247;2433 ## 2 2 2854.6 a 514.8 22.0 2762;2947 ## 3 3 2903.3 a 563.5 24.1 2811;2996 ## 4 4 2776.7 a 436.9 18.7 2684;2869 ## 5 5 2866.9 a 527.1 22.5 2774;2960 ## 6 6 2894.8 a 554.9 23.7 2802;2988 ## 7 7 2873.9 a 534.1 22.8 2781;2967 ## 8 8 2921.5 a 581.7 24.9 2829;3014 ## 9 9 2884.3 a 544.4 23.3 2791;2977 ## 10 10 2832.6 a 492.8 21.1 2740;2925 ## 11 11 2900.1 a 560.3 23.9 2807;2993 ## 12 12 2832.6 a 492.8 21.1 2740;2925 ## 13 13 2815.3 a 475.5 20.3 2723;2908 ## 14 14 2908.3 a 568.5 24.3 2816;3001 ## 15 15 2903.7 a 563.8 24.1 2811;2996 # sheet_write(ss = nova_tr, sheet = &quot;anova_AFsana&quot;) ABC de severidad media de e2 - modelo m1 = lmer(int_e2 ~ trt + (1|rep), data = abc_dat) plot(m1); car::Anova(m1); summary(m1) ## Analysis of Deviance Table (Type II Wald chisquare tests) ## ## Response: int_e2 ## Chisq Df Pr(&gt;Chisq) ## trt 391.09 14 &lt; 2.2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## Linear mixed model fit by REML [&#39;lmerMod&#39;] ## Formula: int_e2 ~ trt + (1 | rep) ## Data: abc_dat ## ## REML criterion at convergence: 422.5 ## ## Scaled residuals: ## Min 1Q Median 3Q Max ## -3.8348 -0.5274 0.0508 0.4699 1.9524 ## ## Random effects: ## Groups Name Variance Std.Dev. ## rep (Intercept) 114.4 10.70 ## Residual 394.0 19.85 ## Number of obs: 60, groups: rep, 4 ## ## Fixed effects: ## Estimate Std. Error t value ## (Intercept) 254.52 11.27 22.58 ## trt2 -206.09 14.04 -14.68 ## trt3 -193.70 14.04 -13.80 ## trt4 -178.77 14.04 -12.74 ## trt5 -214.84 14.04 -15.30 ## trt6 -200.81 14.04 -14.31 ## trt7 -215.91 14.04 -15.38 ## trt8 -202.51 14.04 -14.43 ## trt9 -207.28 14.04 -14.77 ## trt10 -189.64 14.04 -13.51 ## trt11 -199.01 14.04 -14.18 ## trt12 -187.88 14.04 -13.38 ## trt13 -192.79 14.04 -13.73 ## trt14 -194.37 14.04 -13.85 ## trt15 -207.03 14.04 -14.75 ## ## Correlation matrix not shown by default, as p = 15 &gt; 12. ## Use print(x, correlation=TRUE) or ## vcov(x) if you need it emmeans(m1, ~ trt, type = &quot;response&quot;) %&gt;% multcomp::cld(., Letters = letters, alpha = .05, type = &quot;response&quot;, reversed = F) -&gt;res1 plot(res1, alpha =0.5) + geom_vline(xintercept = res1 %&gt;% filter(trt==1) %&gt;% pull(emmean), linetype = 2, col =&quot;gray50&quot;)+ coord_flip()+ geom_point(data = abc_dat, aes(x = int_e2, y = trt), pch=21, position=position_dodge(width=1), size = 2) + geom_text(data = res1, angle=90, vjust=-0.7, aes(x = emmean, y = trt, label = .group), size = 4)+ labs(x=&quot;ABC roya estriada&quot;, y = &quot;Tratamiento&quot;)+ theme_juan(9, &quot;bottom&quot;)+ scale_x_continuous(breaks=scales::pretty_breaks()) # ggsave(&quot;plots/abc_RE_model.jpg&quot;, width = 15, height = 10, units = &quot;cm&quot;, last_plot(), dpi = 600) # # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;plots/abc_RE_model.jpg&quot;, overwrite = TRUE) res1 %&gt;% mutate( # &#39;IC_95%&#39;=paste0(round(lower.CL,0),&quot;;&quot;,round(upper.CL,0)), # dif = (emmean-filter(res1, trt==1)%&gt;%pull(emmean)), `control(%)`=(emmean/filter(res1, trt==1)%&gt;% pull(emmean)-1)*100) %&gt;% dplyr::select(Trat=trt, ABC_Sev= emmean, `Tukey_5%` = .group, `control(%)`) %&gt;% purrr::modify_if(., ~is.numeric(.), ~round(., 1)) %&gt;% arrange(Trat) #%&gt;% ## Trat ABC_Sev Tukey_5% control(%) ## 1 1 254.5 b 0.0 ## 2 2 48.4 a -81.0 ## 3 3 60.8 a -76.1 ## 4 4 75.8 a -70.2 ## 5 5 39.7 a -84.4 ## 6 6 53.7 a -78.9 ## 7 7 38.6 a -84.8 ## 8 8 52.0 a -79.6 ## 9 9 47.2 a -81.4 ## 10 10 64.9 a -74.5 ## 11 11 55.5 a -78.2 ## 12 12 66.6 a -73.8 ## 13 13 61.7 a -75.7 ## 14 14 60.2 a -76.4 ## 15 15 47.5 a -81.3 # sheet_write(ss = nova_tr, sheet = &quot;anova_RE&quot;) "]]
