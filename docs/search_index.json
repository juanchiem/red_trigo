[["index.html", "Análisis de ensayo de protección", " Análisis de ensayo de protección Juan Edwards Código para el análisis de tests de eficiencia de fungicidas en microparcelas. Las variables registradas a campo son: Area foliar (nivel de hoja, muestras de 10 hj/plot ) AF activa1 Severidad de enfermedades presentes (de esta se desprenden incidencia y severidad media) Rendimiento (nivel de parcela) Peso de las parcelas (g) y su humedad La planilla excel asociada a este análisis esta en https://docs.google.com/spreadsheets/d/1t60Eq-h-c0n-eP0TBTzdX_aF_8qOIq5utb8lpSG6lwo/edit?usp=sharing proporción de 1/tot, donde: 0:&lt;50% verde; 1=50%&lt; verde↩︎ "],["1-import.html", "1 Importación de datos 1.1 Datos de sanidad 1.2 Datos de cosecha", " 1 Importación de datos pacman::p_load(tidyverse, googlesheets4, googledrive) gs4_auth(email = &quot;edwardsmolina@gmail.com&quot;) googledrive::drive_auth(email = &quot;edwardsmolina@gmail.com&quot;) nova_tr &lt;- gs4_get(gs4_find(&quot;NOVA_trigo_2020&quot;)$id) # nova_tr %&gt;% sheet_names() # gs4_browse(nova_tr) pacman::p_load(tidyverse) load(&quot;data/nova_trigo.Rdata&quot;) 1.1 Datos de sanidad Interesante que se trata de un dataset con 2 filas de encabezados La primer fila es una inclusión extra para faciltar el proceso. Fila 2 y 3 contienen la info de nuestro interés, y debemos fusionar. data_head &lt;- read_sheet(nova_tr, sheet=&quot;full&quot;, n_max = 2) new_names &lt;- data_head %&gt;% t() %&gt;% as_tibble() %&gt;% unite(., col = &quot;name&quot;, V1, V2, na.rm=TRUE, sep = &quot;_&quot;) %&gt;% pull(name) Luego, leemos el cuerpo del dataset, pero indicamos los nuevos nombres dat_full &lt;- read_sheet(nova_tr, sheet=&quot;full&quot;, skip = 3, col_names = new_names) dat &lt;- dat_full %&gt;% filter(!trt == 16)%&gt;% mutate(fecha = lubridate::ymd(fecha))%&gt;% drop_na(fecha) %&gt;% # mutate(dias = factor(dias)) %&gt;% # mutate(af_sana= verdor-e_int) %&gt;% dplyr::select(id:verdor, matches(&quot;e2&quot;), -contains(&quot;ABC&quot;)) %&gt;% select(-matches(&quot;sev&quot;)) %&gt;% mutate(af_sana = verdor - int_e2) # dat %&gt;% view 1.2 Datos de cosecha cosecha &lt;- read_sheet(nova_tr, sheet=&quot;cosecha&quot;) %&gt;% mutate_at(vars(trt,bk), as.factor) cosecha Mapa de parcelas ggplot()+ geom_point(aes(x = 1:16, y = rep(4.5,16)), size=0.1) + scale_x_continuous(breaks=scales::pretty_breaks(n = 16)) + scale_y_continuous(breaks=scales::pretty_breaks(n = 4)) + cowplot::theme_minimal_grid()+ # geom_hline(yintercept = 4.5)+ # geom_segment(aes(x=4.5, y=4.5, xend=4.5, yend=4.5), linetype = &quot;dashed&quot;, size =0.3) + # geom_segment(aes(x=8.5, y=4.5, xend=8.5, yend=7.5), linetype = &quot;dashed&quot;, size =0.3) + # geom_segment(aes(x=12.5, y=4.5, xend=12.5, yend=7.5), linetype = &quot;dashed&quot;, size =0.3)+ viridis::scale_fill_viridis(discrete=FALSE, direction = -1)+ labs(x=&quot;col&quot;, y=&quot;fila&quot;, fill = &quot;Rendimiento\\n(kg/ha)&quot;)+ geom_tile(data = cosecha, aes(col, fila, fill= kg_ha), alpha =0.9) + geom_hline(yintercept = 2.5, linetype = &quot;dashed&quot;)+ geom_segment(aes(x=8.5, y=0.5, xend=8.5, yend=4.5), linetype = &quot;dashed&quot;, size =0.8) + geom_text(data = cosecha, aes(x = col, fila, label = paste(trt, &quot;\\n&quot;, round(plot,1), &quot;&quot;)), col = &quot;white&quot;, size = 3) # ggsave(last_plot(), file = &quot;plots/mapa_parcelas.png&quot;, w=6.5, h=7) # dat %&gt;% write_sheet(ss=nova_ceb, sheet = &quot;clean&quot;) save(dat, cosecha, file = &quot;data/nova_trigo.Rdata&quot;) "],["2-control.html", "2 Control 2.1 Presion en los testigos de enf_2 2.2 Area foliar - evolución 2.3 Area foliar activa y severidad 2.4 Area foliar Sana 2.5 E2 2.6 Severidad media e2 2.7 ABC de las métricas evaluadas", " 2 Control pacman::p_load(tidyverse) load(&quot;data/nova_trigo.Rdata&quot;) source(here::here(&#39;theme_juan.R&#39;)) # assum_lm &lt;- &quot;https://github.com/juanchiem/R-sources-Juan/blob/master/lm_assumptions.R?raw=TRUE&quot; # devtools::source_url(assum_lm) 2.1 Presion en los testigos de enf_2 Importante: para evitar confusiones, en esta planilla considero a la severidad media (media de las severidades de una muestra incluyendo las hojas sanas), como intensidad, dat %&gt;% filter(trt == 1) %&gt;% group_by(dias) %&gt;% summarise(across(c(&quot;verdor&quot;, &quot;inc_e2&quot;, &quot;int_e2&quot;), ~ mean(.x, na.rm = TRUE))) 2.2 Area foliar - evolución glimpse(dat) \\(Verdor - severidad~media~enf_{(i)}\\) 2.3 Area foliar activa y severidad dat %&gt;% dplyr::select(-matches(&quot;e1&quot;)) %&gt;% pivot_longer( cols = c(&quot;verdor&quot;, &quot;int_e2&quot;), names_to = &quot;var&quot;, values_to = &quot;val&quot;) %&gt;% mutate(var = factor(var), var = fct_relevel(var, &quot;verdor&quot;)) %&gt;% ggplot()+ aes(x=dias, y=val, col = var)+ facet_wrap(&quot;trt&quot;)+ stat_summary(fun = &quot;mean&quot;, geom=&quot;crossbar&quot;, size = 0.1, width = 0.5)+ geom_point(alpha=0.3) + stat_summary(fun=mean, geom=&quot;line&quot;, size=0.7, aes(col=var, group=var)) + scale_color_manual(labels = c( &quot;AF activa&quot;, &quot;Sev media RE(%)&quot;), values = c(&quot;green3&quot;, &quot;red3&quot;)) + theme_juan(12, &quot;top&quot;)+ labs(title = &quot;Evolución área foliar&quot;, y = &quot;%&quot;, x = &quot;Días desde aplicado&quot;, col = &quot;&quot;, caption = &quot;AF activa = Proporción de hojas con &gt;50% de verdor\\nSeveridad media (considera los 0%)&quot;) # ggsave(last_plot(), file = &quot;plots/evol_AF.png&quot;, w=6.5, h=7) # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;nova/nova_trigo/evol_AF_tr.png&quot;, overwrite = TRUE) 2.4 Area foliar Sana \\(Area foliar activa - severidad media de las enfermedades presentes\\) Es una represntación indirecta del área fotisintéticamente activa dat %&gt;% ggplot()+ aes(x=dias, y=af_sana)+ geom_point()+ stat_summary(fun =&quot;mean&quot;, geom=&quot;line&quot;)+ stat_summary(fun = &quot;mean&quot;, geom = &quot;area&quot;, fill = &quot;green&quot;, alpha = .3) + facet_wrap(&quot;trt&quot;)+ labs(title = &quot;Área foliar sana&quot;, col = &quot;Bloque&quot;, y = &quot;%&quot;, x = &quot;Días desde aplicado&quot;, caption = &quot;AF_sana = AF_activa - Severidad media roya estriada)&quot;)+ theme_juan(12, &quot;top&quot;) # ggsave(last_plot(), file = &quot;plots/AF_sana.png&quot;, w=7, h=6) # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;nova/nova_trigo/AF.png&quot;, overwrite = TRUE) # Cuando hubiera mas de una enfermedad, probablemente esto ayudaria # dat_long &lt;- dat %&gt;% # select(trt, rep, dias, matches(&quot;e2&quot;), -contains(&quot;ABC&quot;))%&gt;% # pivot_longer( # cols = matches(&quot;e2&quot;), # names_to = &quot;var&quot;, # values_to = &quot;val&quot;) %&gt;% # separate(var, c(&#39;metric&#39;, &#39;enf&#39;), sep = &#39;_&#39;, convert = TRUE) %&gt;% # mutate(enf_lab = factor(case_when( # enf == &quot;e1&quot;~ &quot;Mancha amarilla&quot;, # enf == &quot;e2&quot;~ &quot;Roya estriada&quot;))) 2.5 E2 2.5.1 Incidencia e2 dat %&gt;% ggplot()+ aes(x=dias, y=inc_e2)+ geom_point()+ stat_summary(fun =&quot;mean&quot;, geom=&quot;line&quot;)+ stat_summary(fun = &quot;mean&quot;, geom = &quot;area&quot;, fill = &quot;#EB5286&quot;, alpha = .5) + facet_wrap(&quot;trt&quot;)+ labs(title = &quot;Incidencia roya estriada&quot;, # col = &quot;&quot;, y = &quot;%&quot;, x = &quot;Días desde aplicado&quot;)+ theme_juan(12, &quot;top&quot;) # ggsave(last_plot(), file = &quot;plots/incidencia_RE.png&quot;, w=7, h=6) # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;nova/nova_trigo/incidencia_RE.png&quot;, overwrite = TRUE) 2.6 Severidad media e2 dat %&gt;% ggplot()+ aes(x=dias, y=int_e2 # col=enf_lab )+ geom_point()+ stat_summary(fun =&quot;mean&quot;, geom= &quot;line&quot;)+ stat_summary(fun = &quot;mean&quot;, geom = &quot;area&quot;, fill = &quot;#EB5286&quot;, alpha = .5) + facet_wrap(&quot;trt&quot;)+ labs(title = &quot;Severidad media roya estriada&quot;, y = &quot;%&quot;, x = &quot;Días desde aplicado&quot;)+ theme_juan(12, &quot;top&quot;) # ggsave(last_plot(), file = &quot;plots/severidad_RE.png&quot;, w=7, h=6) # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;nova/nova_trigo/severidad_RE.png&quot;, overwrite = TRUE) 2.7 ABC de las métricas evaluadas abc_dat &lt;- dat %&gt;% group_by(trt, rep, .drop=FALSE) %&gt;% summarise(across(c(&quot;verdor&quot;, &quot;int_e2&quot;, &quot;af_sana&quot;), ~MESS::auc(dias,.x, type = &quot;linear&quot;))) %&gt;% mutate_at(vars(trt, rep), as.factor) # abc_dat %&gt;% # purrr::modify_if(., ~is.numeric(.), ~round(., 1)) %&gt;% # write_sheet(ss=nova_tr, sheet = &quot;ABC&quot;) pacman::p_load(lme4, emmeans, multcomp) 2.7.1 ABC de AF sana - modelo m0 = lmer(af_sana ~ trt + (1|rep), data = abc_dat) plot(m0) car::Anova(m0) summary(m0) pred_e0 = emmeans(m0, ~ trt, type = &quot;response&quot;) res_e0 &lt;- cld(pred_e0, Letters = letters, alpha = .05, type = &quot;response&quot;, reversed = T) plot(res_e0, alpha =0.5) + geom_vline(xintercept = res_e0 %&gt;% filter(trt==1) %&gt;% pull(emmean), linetype = 2, col =&quot;gray50&quot;)+ coord_flip()+ geom_point(data = abc_dat, aes(x = af_sana, y = trt), pch=21, position=position_dodge(width=1), size = 2) + geom_text(data = res_e0, angle=90, vjust=-0.7, aes(x = emmean, y = trt, label = .group), size = 4)+ labs(x=&quot;ABC AF sana&quot;, y = &quot;Tratamiento&quot;)+ theme_juan(9, &quot;bottom&quot;)+ scale_x_continuous(breaks=scales::pretty_breaks()) # ggsave(&quot;plots/abc_AFsana_model.jpg&quot;, width = 15, height = 10, units = &quot;cm&quot;, last_plot(), dpi = 600) # # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;nova_trigo/abc_AFsana_model.jpg&quot;, overwrite = TRUE) res_e0 %&gt;% mutate( &#39;IC_95%&#39;=paste0(round(lower.CL,0),&quot;;&quot;, round(upper.CL,0)), dif=(emmean-filter(res_e0,trt==1)%&gt;%pull(emmean)), `dif_%`=(emmean/filter(res_e0,trt==1)%&gt;%pull(emmean)-1)*100) %&gt;% dplyr::select(Trat=trt, AF_sana= emmean, `Tukey_5%` = .group, dif,`dif_%`, &#39;IC_95%&#39;) %&gt;% purrr::modify_if(., ~is.numeric(.), ~round(., 1)) %&gt;% arrange(Trat) #%&gt;% # sheet_write(ss = nova_tr, sheet = &quot;anova_AFsana&quot;) 2.7.2 ABC de severidad media de e2 - modelo m1 = lmer(int_e2 ~ trt + (1|rep), data = abc_dat) plot(m1); car::Anova(m1); summary(m1) emmeans(m1, ~ trt, type = &quot;response&quot;) %&gt;% multcomp::cld(., Letters = letters, alpha = .05, type = &quot;response&quot;, reversed = F) -&gt;res1 plot(res1, alpha =0.5) + geom_vline(xintercept = res1 %&gt;% filter(trt==1) %&gt;% pull(emmean), linetype = 2, col =&quot;gray50&quot;)+ coord_flip()+ geom_point(data = abc_dat, aes(x = int_e2, y = trt), pch=21, position=position_dodge(width=1), size = 2) + geom_text(data = res1, angle=90, vjust=-0.7, aes(x = emmean, y = trt, label = .group), size = 4)+ labs(x=&quot;ABC roya estriada&quot;, y = &quot;Tratamiento&quot;)+ theme_juan(9, &quot;bottom&quot;)+ scale_x_continuous(breaks=scales::pretty_breaks()) # ggsave(&quot;plots/abc_RE_model.jpg&quot;, width = 15, height = 10, units = &quot;cm&quot;, last_plot(), dpi = 600) # # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;plots/abc_RE_model.jpg&quot;, overwrite = TRUE) res1 %&gt;% mutate( # &#39;IC_95%&#39;=paste0(round(lower.CL,0),&quot;;&quot;,round(upper.CL,0)), # dif = (emmean-filter(res1, trt==1)%&gt;%pull(emmean)), `control(%)`=(emmean/filter(res1, trt==1)%&gt;% pull(emmean)-1)*100) %&gt;% dplyr::select(Trat=trt, ABC_Sev= emmean, `Tukey_5%` = .group, `control(%)`) %&gt;% purrr::modify_if(., ~is.numeric(.), ~round(., 1)) %&gt;% arrange(Trat) #%&gt;% # sheet_write(ss = nova_tr, sheet = &quot;anova_RE&quot;) "],["3-rinde.html", "3 Rendimiento", " 3 Rendimiento pacman::p_load(tidyverse, lme4, emmeans, multcomp, googlesheets4) # gs4_auth(email = &quot;edwardsmolina@gmail.com&quot;) # googledrive::drive_auth(email = &quot;edwardsmolina@gmail.com&quot;) # nova_tr &lt;- gs4_get(gs4_find(&quot;NOVA_trigo_2020&quot;)$id) # assum_lm &lt;- &quot;https://github.com/juanchiem/R-sources-Juan/blob/master/lm_assumptions.R?raw=TRUE&quot; # devtools::source_url(assum_lm) load(here::here(&quot;data/nova_trigo.Rdata&quot;)) source(here::here(&#39;theme_juan.R&#39;)) glimpse(cosecha) Unificamos trt ya que incluimos 2 testigos por bloque dat &lt;- cosecha %&gt;% group_by(trt, bk) %&gt;% summarise(bk =first(bk), rinde = mean(kg_ha, na.rm =T)) %&gt;% ungroup() %&gt;% droplevels # purrr::modify_if(., ~is.numeric(.), ~round(., 1))# %&gt;% # sheet_write(ss = nova_tr, sheet = &quot;cosecha&quot;) m_y = lmer(rinde ~ trt + (1|bk), data = dat) plot(m_y) car::Anova(m_y) ## Analysis of Deviance Table (Type II Wald chisquare tests) ## ## Response: rinde ## Chisq Df Pr(&gt;Chisq) ## trt 119.68 14 &lt; 2.2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 summary(m_y) ## Linear mixed model fit by REML [&#39;lmerMod&#39;] ## Formula: rinde ~ trt + (1 | bk) ## Data: dat ## ## REML criterion at convergence: 682.8 ## ## Scaled residuals: ## Min 1Q Median 3Q Max ## -1.6528 -0.5349 -0.1337 0.5216 2.1053 ## ## Random effects: ## Groups Name Variance Std.Dev. ## bk (Intercept) 14973 122.4 ## Residual 134266 366.4 ## Number of obs: 60, groups: bk, 4 ## ## Fixed effects: ## Estimate Std. Error t value ## (Intercept) 5813.9 193.2 30.099 ## trt2 1293.4 259.1 4.992 ## trt3 1994.7 259.1 7.699 ## trt4 837.9 259.1 3.234 ## trt5 1766.9 259.1 6.819 ## trt6 1080.9 259.1 4.172 ## trt7 1599.5 259.1 6.173 ## trt8 1993.1 259.1 7.692 ## trt9 1513.5 259.1 5.841 ## trt10 1861.7 259.1 7.185 ## trt11 1855.3 259.1 7.161 ## trt12 1991.8 259.1 7.688 ## trt13 1340.0 259.1 5.172 ## trt14 1447.1 259.1 5.585 ## trt15 1639.2 259.1 6.326 pred = emmeans(m_y, ~ trt, type = &quot;response&quot;) res &lt;- cld(pred, Letters = letters, alpha = .05, type = &quot;response&quot;, reversed = T) dat1 = dat %&gt;% rename(&quot;emmean&quot; =rinde)%&gt;% drop_na(trt)%&gt;% mutate(trt = fct_reorder(trt, emmean, .fun=&#39;mean&#39; )) plot(res, alpha =0.5) + geom_vline(xintercept = filter(res, trt==1) %&gt;% pull(emmean), linetype = 2, col =&quot;gray50&quot;)+ geom_point(data = dat1 , #%&gt;% mutate(trt = fct_reorder(trt, emmean, .fun=&#39;mean&#39;)), aes(y = trt, x = emmean), pch=21, position=position_dodge(width=1), size = 2) + geom_text(data = res, angle=90, vjust=-0.7, aes(x = emmean, y = trt, label = .group), size = 4)+ geom_text(data = res %&gt;% filter(trt==1) %&gt;% as_tibble(), label = &quot;Testigo&quot;, vjust=-0.2, aes(x = emmean, y = 1.5), size = 4)+ coord_flip()+ labs(x=&quot;Rinde (kg/ha)&quot;, y = &quot;Tratamiento&quot;)+ theme_juan(9, &quot;bottom&quot;)+ scale_x_continuous(breaks=scales::pretty_breaks()) ggsave(&quot;plots/trigo_NOVA_rinde_model.jpg&quot;, width = 15, height = 10, units = &quot;cm&quot;, last_plot(), dpi = 600) # # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;plots/trigo_NOVA_rinde_model.jpg&quot;, overwrite = TRUE) res_fin &lt;- res %&gt;% as_tibble() %&gt;% rename(kg_ha = emmean) %&gt;% mutate( dif_kg = (kg_ha- filter(res, trt==1) %&gt;% pull(emmean)), `dif_%` = (kg_ha/filter(res, trt==1) %&gt;% pull(emmean)- 1) * 100) res_fin res_fin %&gt;% mutate( &#39;IC_95%&#39;=paste0(round(lower.CL,0),&quot;;&quot;, round(upper.CL,0))) %&gt;% dplyr::select(Trat =trt, # Rinde_medio= emmean, `Tukey_5%` = .group, `IC_95%`, dif_kg, `dif_%`, -df, -SE, -lower.CL, -upper.CL) #%&gt;% # purrr::modify_if(., ~is.numeric(.), ~round(., 0)) %&gt;% # arrange(Trat) %&gt;% # write_sheet(ss=nova_tr, sheet = &quot;anova_rend&quot;) "]]
