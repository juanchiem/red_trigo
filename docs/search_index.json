[["4-meteo.html", "4 Condiciones meteorológicas 4.1 Precipitaciones 4.2 Temperaturas", " 4 Condiciones meteorológicas 4.1 Precipitaciones pacman::p_load(tidyverse, lubridate, googledrive) load(&quot;data/nova_trigo.Rdata&quot;) source(here::here(&#39;0 themes.R&#39;)) Calcular lluvias acumuladas por década serie20 &lt;- serie %&gt;% filter(year!=2020) %&gt;% group_by(date=if_else(day(date) &gt;= 30, floor_date(date, &quot;20 days&quot;), floor_date(date, &quot;10 days&quot;))) %&gt;% summarize(rain_acum = sum(rain), days = n()) %&gt;% mutate(year = year(date), month = month(date)) %&gt;% ungroup %&gt;% group_by(year) %&gt;% mutate(decada = row_number()) %&gt;% ungroup %&gt;% group_by(decada) %&gt;% summarise(month = first(month), med = quantile(rain_acum, .5, na.rm = T), lower_80=quantile(rain_acum, .2, na.rm = T), # Rango 80% de los años upper_80=quantile(rain_acum, .8, na.rm = T)) serie20 Para la reciente campaña c2020 &lt;- serie %&gt;% group_by(date = if_else(day(date) &gt;= 30, floor_date(date, &quot;20 days&quot;), floor_date(date, &quot;10 days&quot;))) %&gt;% summarize(rain_acum_season = sum(rain)) %&gt;% #, days=n()) %&gt;% mutate(year = year(date), month = month(date)) %&gt;% group_by(year) %&gt;% mutate(decada = row_number()) %&gt;% filter(date &gt; &#39;2020-04-21&#39;, date &lt; &#39;2020-12-22&#39;) %&gt;% left_join(serie20, by = c(&quot;decada&quot;)) %&gt;% mutate(date = as.Date(date)) Incluir días desde aplicación feno &lt;- tibble::tribble( ~Eval, ~date, ~DDA, 0L, &quot;2020-10-31&quot;, 0L, 1L, &quot;2020-11-10&quot;, 10L, 2L, &quot;2020-11-19&quot;, 19L, 3L, &quot;2020-12-01&quot;, 31L ) Balance relativo a la serie bal &lt;- c2020 %&gt;% group_by(month.y) %&gt;% summarise( date = first(date), cs = sum(rain_acum_season), cs_med = sum(med), bal = cs - cs_med) Visualizar la serie y sus bandas de 80-percentil, y valores acumulados por década de la última campaña c2020 %&gt;% ggplot(aes(x=date)) + geom_pointrange(aes(y=med, ymin=lower_80, ymax=upper_80), fill=&#39;white&#39;, color=&#39;deepskyblue&#39;, shape=21, fatten=.7, size=3, position=(p5=position_nudge(x = 5)))+ geom_point(aes(y=rain_acum_season), col =&quot;brown1&quot;, position=p5) + geom_line(aes(y=rain_acum_season, group=1), col =&quot;brown1&quot;, linetype=&quot;dashed&quot;, position=p5)+ # scale_y_continuous(limits=c(0, 100), expand=c(0.05, 0))+ scale_x_date(date_breaks=&quot;1 month&quot;, date_labels=&quot;%b&quot;, expand=expansion(0,0), limits = as.Date(c(&#39;2020-05-01&#39;,&#39;2020-12-31&#39;)))+ labs(x=NULL, y=&quot;ml&quot;, title = &quot;Precipitaciones en Balcarce (decádicas)&quot;, subtitle = &quot;- Campaña 2020 (en puntos rojos)\\n- Serie 2000-2019: mediana (puntos blancos) y rango 80% (barras azules)&quot;, # &quot;mm acumulados por períodos de 10 días&quot;, caption = &quot;Datos de la estación meteorológica de la EEA INTA Balcarce\\ni) Días desde la aplicación (en negritas)\\nii) Balance mensual (mm acumulados) 2020 vs serie 2000-19 (en itálicas)&quot;)+ geom_text(data = feno, aes(x = as.Date(date), y=0, label = DDA), angle = 90, hjust = 0, fontface = &quot;bold&quot;, size=3)+ geom_rug(data = feno, aes(x = as.Date(date)))+ geom_text(data = bal, aes(x = as.Date(date), y=Inf, label = bal), vjust = 2, hjust = -1, fontface = &quot;italic&quot;, size=3)+ theme_dens ggsave(file = &quot;plots/lluvias.png&quot;, w=80, h=50, units=&quot;mm&quot;, dpi=300, scale=2) drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;plots/lluvias.png&quot;, overwrite = FALSE) agosto, septiembre noviembre y diciembre llovio menos que lo normal 2020-2019 4.2 Temperaturas Serie bce_serie &lt;- serie %&gt;% filter(year!=2020) %&gt;% group_by(julian) %&gt;% summarise( month = first(month), avg = mean(tmean, .2, na.rm = T), # Rango 80% de los años (rango interno) lower_80=quantile(tmean, .2, na.rm = T), upper_80=quantile(tmean, .8, na.rm = T), # Min y max de tmean (rango externo) lower_tmean=min(tmean, na.rm = T), upper_tmean=max(tmean, na.rm = T)) %&gt;% ungroup() Campaña reciente camp &lt;- # Fusionar serie con campaña 18/19 serie %&gt;% filter(date &gt; &#39;2020-05-01&#39;, date &lt; &#39;2020-12-30&#39;) %&gt;% left_join(bce_serie, by = c(&quot;julian&quot;, &quot;month&quot;)) %&gt;% mutate(date = as.Date(date)) %&gt;% droplevels() Balance campaña - serie bal_t &lt;- camp %&gt;% group_by(month) %&gt;% summarize(date = first(date), n_days = n(), d_frios = sum(tmean &lt; avg), p_frios = paste0(round(d_frios/n_days*100),&quot;%&quot;), d_calidos = sum(tmean &gt; avg), p_calidos = paste0(round(d_calidos/n_days*100), &quot;%&quot;), ) camp %&gt;% ggplot(aes(date)) + geom_ribbon(aes(ymin = tmean, ymax = pmin(tmean, avg), fill = &quot;+cálido&quot;),alpha=0.5 ) + geom_ribbon(aes(ymin = avg, ymax = pmin(tmean, avg), fill = &quot;+frío&quot;), alpha=0.5) + geom_line(aes(date, avg, linetype = &quot;media 2000-2019 &quot;)) + geom_line(aes(date, tmean, linetype = &quot;campaña 2020&quot;)) + scale_fill_brewer(palette = &quot;Set1&quot;, direction = 1)+ # scale_x_date(date_breaks=&quot;1 month&quot;, date_labels=&quot;%b&quot;, expand=expansion(0.01,0))+ scale_x_date(date_breaks=&quot;1 month&quot;, date_labels=&quot;%b&quot;, expand=expansion(0,0), limits = as.Date(c(&#39;2020-05-01&#39;,&#39;2020-12-31&#39;)))+ geom_text(data = feno, aes(x = as.Date(date), y=0, label = DDA), angle = 90, hjust = 0, fontface = &quot;bold&quot;, size=3)+ geom_rug(data = feno, aes(x = as.Date(date)))+ geom_text(data = bal_t, aes(x = as.Date(date), y=Inf, label = p_calidos), col = &quot;red3&quot;, vjust = 2, hjust = -1, fontface = &quot;italic&quot;, size=3)+ geom_text(data = bal_t, aes(x = as.Date(date), y=-Inf, label = p_frios), vjust = -3, hjust = -1, fontface = &quot;italic&quot;, size=3, col =&quot;steelblue&quot;)+ labs(fill=&quot;&quot;, linetype=&quot;&quot;, x =&quot;&quot;, y =&quot;T°&quot;, title = &quot;Temperatura media&quot;, caption = &quot;Datos de la estación meteorológica de la EEA INTA Balcarce\\ni) Días desde la aplicación (en negritas)\\nii) Proporción de días mas calidos/frios por mes (en colores)&quot;)+ # \\niii)*Fecha de antesis&quot;)+ # annotate(&#39;text&#39;, x = as.Date(&quot;2020-11-18&quot;), y = 8, label=&#39;&quot;*&quot;&#39;, parse=FALSE, size = 7) + theme_dens ggsave(file = &quot;plots/temp.png&quot;, w=70, h=50, units=&quot;mm&quot;, dpi=300, scale=2) drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;plots/temp.png&quot;, overwrite = FALSE) "]]
