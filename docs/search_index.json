[["2-control.html", "2 Control 2.1 Presion en los testigos de enf_2 2.2 Area foliar - evolución 2.3 Area foliar activa y severidad 2.4 Area foliar Sana 2.5 E2 2.6 Severidad media e2 2.7 ABC de las métricas evaluadas", " 2 Control pacman::p_load(tidyverse) load(&quot;data/nova_trigo.Rdata&quot;) source(here::here(&#39;theme_juan.R&#39;)) # assum_lm &lt;- &quot;https://github.com/juanchiem/R-sources-Juan/blob/master/lm_assumptions.R?raw=TRUE&quot; # devtools::source_url(assum_lm) 2.1 Presion en los testigos de enf_2 Importante: para evitar confusiones, en esta planilla considero a la severidad media (media de las severidades de una muestra incluyendo las hojas sanas), como intensidad, dat %&gt;% filter(trt == 1) %&gt;% group_by(dias) %&gt;% summarise(across(c(&quot;verdor&quot;, &quot;inc_e2&quot;, &quot;int_e2&quot;), ~ mean(.x, na.rm = TRUE))) ## # A tibble: 4 x 4 ## dias verdor inc_e2 int_e2 ## &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 0 100 62.2 5.58 ## 2 10 100 72.3 6.74 ## 3 19 93.4 71.1 12.1 ## 4 31 62.1 56.4 3.79 2.2 Area foliar - evolución glimpse(dat) ## Rows: 240 ## Columns: 10 ## $ id &lt;chr&gt; &quot;1.1&quot;, &quot;1.1&quot;, &quot;1.1&quot;, &quot;1.1&quot;, &quot;1.2&quot;, &quot;1.2&quot;, &quot;1.2&quot;, &quot;1.2&quot;, &quot;1.3&quot;,… ## $ trt &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2,… ## $ rep &lt;dbl&gt; 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 1, 1, 1, 1, 2,… ## $ eval &lt;dbl&gt; 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0,… ## $ fecha &lt;date&gt; 2020-10-31, 2020-11-10, 2020-11-19, 2020-12-01, 2020-10-31, 2… ## $ dias &lt;dbl&gt; 0, 10, 19, 31, 0, 10, 19, 31, 0, 10, 19, 31, 0, 10, 19, 31, 0,… ## $ verdor &lt;dbl&gt; 100.00000, 100.00000, 96.00000, 60.86957, 100.00000, 100.00000… ## $ inc_e2 &lt;dbl&gt; 62.222222, 76.666667, 79.166667, 50.000000, 62.222222, 79.3103… ## $ int_e2 &lt;dbl&gt; 5.5760684, 6.7977778, 12.2854938, 4.4285714, 5.5760684, 8.4267… ## $ af_sana &lt;dbl&gt; 94.42393, 93.20222, 83.71451, 56.44099, 94.42393, 91.57328, 71… \\(Verdor - severidad~media~enf_{(i)}\\) 2.3 Area foliar activa y severidad dat %&gt;% dplyr::select(-matches(&quot;e1&quot;)) %&gt;% pivot_longer( cols = c(&quot;verdor&quot;, &quot;int_e2&quot;), names_to = &quot;var&quot;, values_to = &quot;val&quot;) %&gt;% mutate(var = factor(var), var = fct_relevel(var, &quot;verdor&quot;)) %&gt;% ggplot()+ aes(x=dias, y=val, col = var)+ facet_wrap(&quot;trt&quot;)+ stat_summary(fun = &quot;mean&quot;, geom=&quot;crossbar&quot;, size = 0.1, width = 0.5)+ geom_point(alpha=0.3) + stat_summary(fun=mean, geom=&quot;line&quot;, size=0.7, aes(col=var, group=var)) + scale_color_manual(labels = c( &quot;AF activa&quot;, &quot;Sev media RE(%)&quot;), values = c(&quot;green&quot;, &quot;red&quot;)) + theme_juan(12, &quot;top&quot;)+ labs(title = &quot;Evolución área foliar&quot;, y = &quot;%&quot;, x = &quot;Días desde aplicado&quot;, col = &quot;&quot;, caption = &quot;AF activa = Promedio de score 0-4 de cada hoja evaluada\\n(Según verdor: 0=0%; 1=1-25%; 2=25-50%; 3=50-75%; 4=75-100%\\nSeveridad media (considera los 0%)&quot;) # ggsave(last_plot(), file = &quot;plots/evol_AF.png&quot;, w=6.5, h=7) # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;nova/nova_trigo/evol_AF_tr.png&quot;, overwrite = TRUE) 2.4 Area foliar Sana \\(Area foliar activa - severidad media de las enfermedades presentes\\) Es una represntación indirecta del área fotisintéticamente activa dat %&gt;% ggplot()+ aes(x=dias, y=af_sana)+ geom_point()+ stat_summary(fun =&quot;mean&quot;, geom=&quot;line&quot;)+ stat_summary(fun = &quot;mean&quot;, geom = &quot;area&quot;, fill = &quot;green&quot;, alpha = .3) + facet_wrap(&quot;trt&quot;)+ labs(title = &quot;Área foliar sana&quot;, col = &quot;Bloque&quot;, y = &quot;%&quot;, x = &quot;Días desde aplicado&quot;, caption = &quot;AF_sana = AF_activa - Severidad media roya estriada)&quot;)+ theme_juan(12, &quot;top&quot;) # ggsave(last_plot(), file = &quot;plots/AF_sana.png&quot;, w=7, h=6) # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;nova/nova_trigo/AF.png&quot;, overwrite = TRUE) # Cuando hubiera mas de una enfermedad, probablemente esto ayudaria # dat_long &lt;- dat %&gt;% # select(trt, rep, dias, matches(&quot;e2&quot;), -contains(&quot;ABC&quot;))%&gt;% # pivot_longer( # cols = matches(&quot;e2&quot;), # names_to = &quot;var&quot;, # values_to = &quot;val&quot;) %&gt;% # separate(var, c(&#39;metric&#39;, &#39;enf&#39;), sep = &#39;_&#39;, convert = TRUE) %&gt;% # mutate(enf_lab = factor(case_when( # enf == &quot;e1&quot;~ &quot;Mancha amarilla&quot;, # enf == &quot;e2&quot;~ &quot;Roya estriada&quot;))) 2.5 E2 2.5.1 Incidencia e2 dat %&gt;% ggplot()+ aes(x=dias, y=inc_e2)+ geom_point()+ stat_summary(fun =&quot;mean&quot;, geom=&quot;line&quot;)+ stat_summary(fun = &quot;mean&quot;, geom = &quot;area&quot;, fill = &quot;#EB5286&quot;, alpha = .5) + facet_wrap(&quot;trt&quot;)+ labs(title = &quot;Incidencia roya estriada&quot;, # col = &quot;&quot;, y = &quot;%&quot;, x = &quot;Días desde aplicado&quot;)+ theme_juan(12, &quot;top&quot;) # ggsave(last_plot(), file = &quot;plots/incidencia_RE.png&quot;, w=7, h=6) # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;nova/nova_trigo/incidencia_RE.png&quot;, overwrite = TRUE) 2.6 Severidad media e2 dat %&gt;% ggplot()+ aes(x=dias, y=int_e2 # col=enf_lab )+ geom_point()+ stat_summary(fun =&quot;mean&quot;, geom= &quot;line&quot;)+ stat_summary(fun = &quot;mean&quot;, geom = &quot;area&quot;, fill = &quot;#EB5286&quot;, alpha = .5) + facet_wrap(&quot;trt&quot;)+ labs(title = &quot;Severidad media roya estriada&quot;, y = &quot;%&quot;, x = &quot;Días desde aplicado&quot;)+ theme_juan(12, &quot;top&quot;) # ggsave(last_plot(), file = &quot;plots/severidad_RE.png&quot;, w=7, h=6) # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;nova/nova_trigo/severidad_RE.png&quot;, overwrite = TRUE) 2.7 ABC de las métricas evaluadas abc_dat &lt;- dat %&gt;% group_by(trt, rep, .drop=FALSE) %&gt;% summarise(across(c(&quot;verdor&quot;, &quot;int_e2&quot;, &quot;af_sana&quot;), ~MESS::auc(dias,.x, type = &quot;linear&quot;))) %&gt;% mutate_at(vars(trt, rep), as.factor) ## `summarise()` has grouped output by &#39;trt&#39;. You can override using the `.groups` argument. # abc_dat %&gt;% # purrr::modify_if(., ~is.numeric(.), ~round(., 1)) %&gt;% # write_sheet(ss=nova_tr, sheet = &quot;ABC&quot;) pacman::p_load(lme4, emmeans, multcomp) 2.7.1 ABC de AF sana - modelo m0 = lmer(af_sana ~ trt + (1|rep), data = abc_dat) plot(m0) car::Anova(m0) ## Registered S3 methods overwritten by &#39;car&#39;: ## method from ## influence.merMod lme4 ## cooks.distance.influence.merMod lme4 ## dfbeta.influence.merMod lme4 ## dfbetas.influence.merMod lme4 ## Analysis of Deviance Table (Type II Wald chisquare tests) ## ## Response: af_sana ## Chisq Df Pr(&gt;Chisq) ## trt 112.65 14 &lt; 2.2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 summary(m0) ## Linear mixed model fit by REML [&#39;lmerMod&#39;] ## Formula: af_sana ~ trt + (1 | rep) ## Data: abc_dat ## ## REML criterion at convergence: 537.6 ## ## Scaled residuals: ## Min 1Q Median 3Q Max ## -3.05940 -0.44639 0.04948 0.43748 2.71456 ## ## Random effects: ## Groups Name Variance Std.Dev. ## rep (Intercept) 297.9 17.26 ## Residual 5466.9 73.94 ## Number of obs: 60, groups: rep, 4 ## ## Fixed effects: ## Estimate Std. Error t value ## (Intercept) 2561.78 37.96 67.481 ## trt2 385.50 52.28 7.373 ## trt3 429.69 52.28 8.219 ## trt4 329.41 52.28 6.301 ## trt5 383.81 52.28 7.341 ## trt6 401.88 52.28 7.687 ## trt7 374.46 52.28 7.162 ## trt8 438.40 52.28 8.385 ## trt9 400.80 52.28 7.666 ## trt10 365.15 52.28 6.984 ## trt11 399.58 52.28 7.643 ## trt12 399.36 52.28 7.639 ## trt13 398.51 52.28 7.622 ## trt14 403.21 52.28 7.712 ## trt15 404.22 52.28 7.732 ## ## Correlation matrix not shown by default, as p = 15 &gt; 12. ## Use print(x, correlation=TRUE) or ## vcov(x) if you need it pred_e0 = emmeans(m0, ~ trt, type = &quot;response&quot;) res_e0 &lt;- cld(pred_e0, Letters = letters, alpha = .05, type = &quot;response&quot;, reversed = T) plot(res_e0, alpha =0.5) + geom_vline(xintercept = res_e0 %&gt;% filter(trt==1) %&gt;% pull(emmean), linetype = 2, col =&quot;gray50&quot;)+ coord_flip()+ geom_point(data = abc_dat, aes(x = af_sana, y = trt), pch=21, position=position_dodge(width=1), size = 2) + geom_text(data = res_e0, angle=90, vjust=-0.7, aes(x = emmean, y = trt, label = .group), size = 4)+ labs(x=&quot;ABC AF sana&quot;, y = &quot;Tratamiento&quot;)+ theme_juan(9, &quot;bottom&quot;)+ scale_x_continuous(breaks=scales::pretty_breaks()) # ggsave(&quot;plots/abc_AFsana_model.jpg&quot;, width = 15, height = 10, units = &quot;cm&quot;, last_plot(), dpi = 600) # # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;nova_trigo/abc_AFsana_model.jpg&quot;, overwrite = TRUE) res_e0 %&gt;% mutate( &#39;IC_95%&#39;=paste0(round(lower.CL,0),&quot;;&quot;, round(upper.CL,0)), dif=(emmean-filter(res_e0,trt==1)%&gt;%pull(emmean)), `dif_%`=(emmean/filter(res_e0,trt==1)%&gt;%pull(emmean)-1)*100) %&gt;% dplyr::select(Trat=trt, AF_sana= emmean, `Tukey_5%` = .group, dif,`dif_%`, &#39;IC_95%&#39;) %&gt;% purrr::modify_if(., ~is.numeric(.), ~round(., 1)) %&gt;% arrange(Trat) #%&gt;% ## Trat AF_sana Tukey_5% dif dif_% IC_95% ## 1 1 2561.8 b 0.0 0.0 2485;2638 ## 2 2 2947.3 a 385.5 15.0 2871;3024 ## 3 3 2991.5 a 429.7 16.8 2915;3068 ## 4 4 2891.2 a 329.4 12.9 2815;2968 ## 5 5 2945.6 a 383.8 15.0 2869;3022 ## 6 6 2963.7 a 401.9 15.7 2887;3040 ## 7 7 2936.2 a 374.5 14.6 2860;3013 ## 8 8 3000.2 a 438.4 17.1 2924;3077 ## 9 9 2962.6 a 400.8 15.6 2886;3039 ## 10 10 2926.9 a 365.2 14.3 2850;3003 ## 11 11 2961.4 a 399.6 15.6 2885;3038 ## 12 12 2961.1 a 399.4 15.6 2885;3038 ## 13 13 2960.3 a 398.5 15.6 2884;3037 ## 14 14 2965.0 a 403.2 15.7 2888;3042 ## 15 15 2966.0 a 404.2 15.8 2889;3043 # sheet_write(ss = nova_tr, sheet = &quot;anova_AFsana&quot;) 2.7.2 ABC de severidad media de e2 - modelo m1 = lmer(int_e2 ~ trt + (1|rep), data = abc_dat) plot(m1); car::Anova(m1); summary(m1) ## Analysis of Deviance Table (Type II Wald chisquare tests) ## ## Response: int_e2 ## Chisq Df Pr(&gt;Chisq) ## trt 349.04 14 &lt; 2.2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## Linear mixed model fit by REML [&#39;lmerMod&#39;] ## Formula: int_e2 ~ trt + (1 | rep) ## Data: abc_dat ## ## REML criterion at convergence: 421.7 ## ## Scaled residuals: ## Min 1Q Median 3Q Max ## -3.5643 -0.5393 0.0071 0.4969 2.1489 ## ## Random effects: ## Groups Name Variance Std.Dev. ## rep (Intercept) 106.9 10.34 ## Residual 388.1 19.70 ## Number of obs: 60, groups: rep, 4 ## ## Fixed effects: ## Estimate Std. Error t value ## (Intercept) 241.79 11.12 21.73 ## trt2 -193.05 13.93 -13.86 ## trt3 -180.65 13.93 -12.97 ## trt4 -165.28 13.93 -11.87 ## trt5 -201.94 13.93 -14.50 ## trt6 -188.08 13.93 -13.50 ## trt7 -202.89 13.93 -14.56 ## trt8 -189.68 13.93 -13.62 ## trt9 -194.20 13.93 -13.94 ## trt10 -176.60 13.93 -12.68 ## trt11 -186.18 13.93 -13.37 ## trt12 -173.99 13.93 -12.49 ## trt13 -179.00 13.93 -12.85 ## trt14 -181.64 13.93 -13.04 ## trt15 -193.99 13.93 -13.93 ## ## Correlation matrix not shown by default, as p = 15 &gt; 12. ## Use print(x, correlation=TRUE) or ## vcov(x) if you need it emmeans(m1, ~ trt, type = &quot;response&quot;) %&gt;% multcomp::cld(., Letters = letters, alpha = .05, type = &quot;response&quot;, reversed = F) -&gt;res1 plot(res1, alpha =0.5) + geom_vline(xintercept = res1 %&gt;% filter(trt==1) %&gt;% pull(emmean), linetype = 2, col =&quot;gray50&quot;)+ coord_flip()+ geom_point(data = abc_dat, aes(x = int_e2, y = trt), pch=21, position=position_dodge(width=1), size = 2) + geom_text(data = res1, angle=90, vjust=-0.7, aes(x = emmean, y = trt, label = .group), size = 4)+ labs(x=&quot;ABC roya estriada&quot;, y = &quot;Tratamiento&quot;)+ theme_juan(9, &quot;bottom&quot;)+ scale_x_continuous(breaks=scales::pretty_breaks()) # ggsave(&quot;plots/abc_RE_model.jpg&quot;, width = 15, height = 10, units = &quot;cm&quot;, last_plot(), dpi = 600) # # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;plots/abc_RE_model.jpg&quot;, overwrite = TRUE) res1 %&gt;% mutate( # &#39;IC_95%&#39;=paste0(round(lower.CL,0),&quot;;&quot;,round(upper.CL,0)), # dif = (emmean-filter(res1, trt==1)%&gt;%pull(emmean)), `control(%)`=(emmean/filter(res1, trt==1)%&gt;% pull(emmean)-1)*100) %&gt;% dplyr::select(Trat=trt, ABC_Sev= emmean, `Tukey_5%` = .group, `control(%)`) %&gt;% purrr::modify_if(., ~is.numeric(.), ~round(., 1)) %&gt;% arrange(Trat) #%&gt;% ## Trat ABC_Sev Tukey_5% control(%) ## 1 1 241.8 b 0.0 ## 2 2 48.7 a -79.8 ## 3 3 61.1 a -74.7 ## 4 4 76.5 a -68.4 ## 5 5 39.8 a -83.5 ## 6 6 53.7 a -77.8 ## 7 7 38.9 a -83.9 ## 8 8 52.1 a -78.4 ## 9 9 47.6 a -80.3 ## 10 10 65.2 a -73.0 ## 11 11 55.6 a -77.0 ## 12 12 67.8 a -72.0 ## 13 13 62.8 a -74.0 ## 14 14 60.2 a -75.1 ## 15 15 47.8 a -80.2 # sheet_write(ss = nova_tr, sheet = &quot;anova_RE&quot;) "]]
