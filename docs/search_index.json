[["3-rinde.html", "3 Rendimiento", " 3 Rendimiento pacman::p_load(tidyverse, lme4, emmeans, multcomp, googlesheets4) # gs4_auth(email = &quot;edwardsmolina@gmail.com&quot;) # googledrive::drive_auth(email = &quot;edwardsmolina@gmail.com&quot;) # nova_tr &lt;- gs4_get(gs4_find(&quot;NOVA_trigo_2020&quot;)$id) # assum_lm &lt;- &quot;https://github.com/juanchiem/R-sources-Juan/blob/master/lm_assumptions.R?raw=TRUE&quot; # devtools::source_url(assum_lm) load(here::here(&quot;data/nova_trigo.Rdata&quot;)) source(here::here(&#39;theme_juan.R&#39;)) glimpse(cosecha) Unificamos trt ya que incluimos 2 testigos por bloque dat &lt;- cosecha %&gt;% group_by(trt, bk) %&gt;% summarise(bk =first(bk), rinde = mean(kg_ha, na.rm =T)) %&gt;% ungroup() %&gt;% droplevels ## `summarise()` has grouped output by &#39;trt&#39;. You can override using the `.groups` argument. # purrr::modify_if(., ~is.numeric(.), ~round(., 1))# %&gt;% # sheet_write(ss = nova_tr, sheet = &quot;cosecha&quot;) m_y = lmer(rinde ~ trt + (1|bk), data = dat) plot(m_y) car::Anova(m_y) ## Registered S3 methods overwritten by &#39;car&#39;: ## method from ## influence.merMod lme4 ## cooks.distance.influence.merMod lme4 ## dfbeta.influence.merMod lme4 ## dfbetas.influence.merMod lme4 ## Analysis of Deviance Table (Type II Wald chisquare tests) ## ## Response: rinde ## Chisq Df Pr(&gt;Chisq) ## trt 119.68 14 &lt; 2.2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 summary(m_y) ## Linear mixed model fit by REML [&#39;lmerMod&#39;] ## Formula: rinde ~ trt + (1 | bk) ## Data: dat ## ## REML criterion at convergence: 682.8 ## ## Scaled residuals: ## Min 1Q Median 3Q Max ## -1.6528 -0.5349 -0.1337 0.5216 2.1053 ## ## Random effects: ## Groups Name Variance Std.Dev. ## bk (Intercept) 14973 122.4 ## Residual 134266 366.4 ## Number of obs: 60, groups: bk, 4 ## ## Fixed effects: ## Estimate Std. Error t value ## (Intercept) 5813.9 193.2 30.099 ## trt2 1293.4 259.1 4.992 ## trt3 1994.7 259.1 7.699 ## trt4 837.9 259.1 3.234 ## trt5 1766.9 259.1 6.819 ## trt6 1080.9 259.1 4.172 ## trt7 1599.5 259.1 6.173 ## trt8 1993.1 259.1 7.692 ## trt9 1513.5 259.1 5.841 ## trt10 1861.7 259.1 7.185 ## trt11 1855.3 259.1 7.161 ## trt12 1991.8 259.1 7.688 ## trt13 1340.0 259.1 5.172 ## trt14 1447.1 259.1 5.585 ## trt15 1639.2 259.1 6.326 ## ## Correlation matrix not shown by default, as p = 15 &gt; 12. ## Use print(x, correlation=TRUE) or ## vcov(x) if you need it pred = emmeans(m_y, ~ trt, type = &quot;response&quot;) res &lt;- cld(pred, Letters = letters, alpha = .05, type = &quot;response&quot;, reversed = T) dat1 = dat %&gt;% rename(&quot;emmean&quot; =rinde)%&gt;% drop_na(trt)%&gt;% mutate(trt = fct_reorder(trt, emmean, .fun=&#39;mean&#39; )) plot(res, alpha =0.5) + geom_vline(xintercept = filter(res, trt==1) %&gt;% pull(emmean), linetype = 2, col =&quot;gray50&quot;)+ geom_point(data = dat1 , #%&gt;% mutate(trt = fct_reorder(trt, emmean, .fun=&#39;mean&#39;)), aes(y = trt, x = emmean), pch=21, position=position_dodge(width=1), size = 2) + geom_text(data = res, angle=90, vjust=-0.7, aes(x = emmean, y = trt, label = .group), size = 4)+ geom_text(data = res %&gt;% filter(trt==1) %&gt;% as_tibble(), label = &quot;Testigo&quot;, vjust=-0.2, aes(x = emmean, y = 1.5), size = 4)+ coord_flip()+ labs(x=&quot;Rinde (kg/ha)&quot;, y = &quot;Tratamiento&quot;)+ theme_juan(9, &quot;bottom&quot;)+ scale_x_continuous(breaks=scales::pretty_breaks()) ggsave(&quot;plots/trigo_NOVA_rinde_model.jpg&quot;, width = 15, height = 10, units = &quot;cm&quot;, last_plot(), dpi = 600) # # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;plots/trigo_NOVA_rinde_model.jpg&quot;, overwrite = TRUE) res_fin &lt;- res %&gt;% as_tibble() %&gt;% rename(kg_ha = emmean) %&gt;% mutate( dif_kg = (kg_ha- filter(res, trt==1) %&gt;% pull(emmean)), `dif_%` = (kg_ha/filter(res, trt==1) %&gt;% pull(emmean)- 1) * 100) res_fin res_fin %&gt;% mutate( &#39;IC_95%&#39;=paste0(round(lower.CL,0),&quot;;&quot;, round(upper.CL,0))) %&gt;% dplyr::select(Trat =trt, # Rinde_medio= emmean, `Tukey_5%` = .group, `IC_95%`, dif_kg, `dif_%`, -df, -SE, -lower.CL, -upper.CL) #%&gt;% # purrr::modify_if(., ~is.numeric(.), ~round(., 0)) %&gt;% # arrange(Trat) %&gt;% # write_sheet(ss=nova_tr, sheet = &quot;anova_rend&quot;) "]]
