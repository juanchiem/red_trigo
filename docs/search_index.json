[["3-rinde.html", "3 Rendimiento", " 3 Rendimiento pacman::p_load(tidyverse, lme4, emmeans, multcomp, googlesheets4) # gs4_auth(email = &quot;edwardsmolina@gmail.com&quot;) # googledrive::drive_auth(email = &quot;edwardsmolina@gmail.com&quot;) # nova_tr &lt;- gs4_get(gs4_find(&quot;NOVA_trigo_2020&quot;)$id) # assum_lm &lt;- &quot;https://github.com/juanchiem/R-sources-Juan/blob/master/lm_assumptions.R?raw=TRUE&quot; # devtools::source_url(assum_lm) load(here::here(&quot;data/nova_trigo.Rdata&quot;)) source(here::here(&#39;theme_juan.R&#39;)) glimpse(cosecha) Unificamos trt ya que incluimos 2 testigos por bloque dat &lt;- cosecha %&gt;% group_by(trt, bk) %&gt;% summarise(bk =first(bk), rinde = mean(kg_ha, na.rm =T)) %&gt;% ungroup() %&gt;% droplevels # purrr::modify_if(., ~is.numeric(.), ~round(., 1))# %&gt;% # sheet_write(ss = nova_tr, sheet = &quot;cosecha&quot;) m_y = lmer(rinde ~ trt + (1|bk), data = dat) plot(m_y) car::Anova(m_y) summary(m_y) pred = emmeans(m_y, ~ trt, type = &quot;response&quot;) res &lt;- cld(pred, Letters = letters, alpha = .05, type = &quot;response&quot;, reversed = T) dat1 = dat %&gt;% rename(&quot;emmean&quot; =rinde)%&gt;% drop_na(trt)%&gt;% mutate(trt = fct_reorder(trt, emmean, .fun=&#39;mean&#39; )) plot(res, alpha =0.5) + geom_vline(xintercept = filter(res, trt==1) %&gt;% pull(emmean), linetype = 2, col =&quot;gray50&quot;)+ geom_point(data = dat1 , #%&gt;% mutate(trt = fct_reorder(trt, emmean, .fun=&#39;mean&#39;)), aes(y = trt, x = emmean), pch=21, position=position_dodge(width=1), size = 2) + geom_text(data = res, angle=90, vjust=-0.7, aes(x = emmean, y = trt, label = .group), size = 4)+ geom_text(data = res %&gt;% filter(trt==1) %&gt;% as_tibble(), label = &quot;Testigo&quot;, vjust=-0.2, aes(x = emmean, y = 1.5), size = 4)+ coord_flip()+ labs(x=&quot;Rinde (kg/ha)&quot;, y = &quot;Tratamiento&quot;)+ theme_juan(9, &quot;bottom&quot;)+ scale_x_continuous(breaks=scales::pretty_breaks()) # ggsave(&quot;plots/trigo_NOVA_rinde_model.jpg&quot;, width = 15, height = 10, units = &quot;cm&quot;, last_plot(), dpi = 600) # # drive_upload(path = as_dribble(&quot;fina_2020/NOVA&quot;), &quot;plots/trigo_NOVA_rinde_model.jpg&quot;, overwrite = TRUE) res_fin &lt;- res %&gt;% as_tibble() %&gt;% rename(kg_ha = emmean) %&gt;% mutate( dif_kg = (kg_ha- filter(res, trt==1) %&gt;% pull(emmean)), `dif_%` = (kg_ha/filter(res, trt==1) %&gt;% pull(emmean)- 1) * 100) res_fin res_fin %&gt;% mutate( &#39;IC_95%&#39;=paste0(round(lower.CL,0),&quot;;&quot;, round(upper.CL,0))) %&gt;% dplyr::select(Trat =trt, # Rinde_medio= emmean, `Tukey_5%` = .group, `IC_95%`, dif_kg, `dif_%`, -df, -SE, -lower.CL, -upper.CL) #%&gt;% # purrr::modify_if(., ~is.numeric(.), ~round(., 0)) %&gt;% # arrange(Trat) %&gt;% # write_sheet(ss=nova_tr, sheet = &quot;anova_rend&quot;) "]]
